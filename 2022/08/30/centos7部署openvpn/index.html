

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  
    <meta name="description" content="cenos7 openvpn部署">
<meta property="og:type" content="article">
<meta property="og:title" content="centos7部署openvpn">
<meta property="og:url" content="http://example.com/2022/08/30/centos7%E9%83%A8%E7%BD%B2openvpn/index.html">
<meta property="og:site_name" content="5-12 23:30">
<meta property="og:description" content="cenos7 openvpn部署">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="c:/Users/zhangk/blog/source_posts/centos7部署openvpn/image-20220825164214339.png">
<meta property="og:image" content="c:/Users/zhangk/blog/source_posts/centos7部署openvpn/image-20220824234102001.png">
<meta property="og:image" content="c:/Users/zhangk/blog/source_posts/centos7部署openvpn/image-20220824234244443.png">
<meta property="og:image" content="c:/Users/zhangk/blog/source_posts/centos7部署openvpn/image-20220824234301566.png">
<meta property="og:image" content="c:/Users/zhangk/blog/source_posts/centos7部署openvpn/image-20220824235752859.png">
<meta property="og:image" content="c:/Users/zhangk/blog/source_posts/centos7部署openvpn/image-20220825000006331.png">
<meta property="og:image" content="c:/Users/zhangk/blog/source_posts/centos7部署openvpn/image-20220825000039228.png">
<meta property="og:image" content="c:/Users/zhangk/blog/source_posts/centos7部署openvpn/image-20220825000058164.png">
<meta property="og:image" content="c:/Users/zhangk/blog/source_posts/centos7部署openvpn/image-20220825000128748.png">
<meta property="og:image" content="c:/Users/zhangk/blog/source_posts/centos7部署openvpn/image-20220825000141848.png">
<meta property="og:image" content="c:/Users/zhangk/blog/source_posts/centos7部署openvpn/image-20220825000321994.png">
<meta property="og:image" content="c:/Users/zhangk/blog/source_posts/centos7部署openvpn/image-20220825164747383.png">
<meta property="og:image" content="http://example.com/2022/08/30/centos7%E9%83%A8%E7%BD%B2openvpn/image-20220830231855729-16618737586081.png">
<meta property="article:published_time" content="2022-08-30T23:34:35.000Z">
<meta property="article:modified_time" content="2022-08-30T15:58:22.488Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="c:/Users/zhangk/blog/source_posts/centos7部署openvpn/image-20220825164214339.png">
  
  
  <title>centos7部署openvpn - 5-12 23:30</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hint.css@2/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.2"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                About
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="centos7部署openvpn">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2022-08-30 23:34" pubdate>
        August 30, 2022 pm
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      31k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      256 分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">centos7部署openvpn</h1>
            
            <div class="markdown-body">
              <h1 id="cenos7-openvpn部署"><a href="#cenos7-openvpn部署" class="headerlink" title="cenos7 openvpn部署"></a>cenos7 openvpn部署</h1><span id="more"></span>

<p>[TOC]</p>
<h1 id="一、环境准备"><a href="#一、环境准备" class="headerlink" title="一、环境准备"></a>一、环境准备</h1><ul>
<li><p>openvpn 服务端 centos7</p>
<p>IP 192.168.1.99</p>
<p>test-server 192.168.1.250</p>
<p>关闭SElinux</p>
<p>关闭防火墙</p>
</li>
</ul>
<h1 id="二、安装"><a href="#二、安装" class="headerlink" title="二、安装"></a>二、安装</h1><h2 id="1-epel源配置"><a href="#1-epel源配置" class="headerlink" title="1.epel源配置"></a>1.epel源配置</h2><p>这里我采用的是阿里云</p>
<p><a target="_blank" rel="noopener" href="https://developer.aliyun.com/mirror/epel?spm=a2c6h.13651102.0.0.3b0f1b116S0OUX">https://developer.aliyun.com/mirror/epel?spm=a2c6h.13651102.0.0.3b0f1b116S0OUX</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">centos7执行该命令</span><br>wget -O /etc/yum.repos.d/epel.repo https://mirrors.aliyun.com/repo/epel-7.repo<br>[root@VPN ~]# yum repolist<br>Loaded plugins: fastestmirror<br>Loading mirror speeds from cached hostfile<br> * base: mirrors.aliyun.com<br> * extras: mirrors.aliyun.com<br> * updates: mirrors.aliyun.com<br>repo id                                                                               repo name                                                                                                           status<br>base/7/x86_64                                                                         CentOS-7 - Base                                                                                                     10,072<br>epel/x86_64   #这里显示已经有EPEL仓库了，说明配置生效了                                                                        Extra Packages for Enterprise Linux 7 - x86_64                                                                      13,757<br>extras/7/x86_64                                                                       CentOS-7 - Extras                                                                                                      512<br>updates/7/x86_64                                                                      CentOS-7 - Updates                                                                                                   4,135<br>repolist: 28,476<br></code></pre></td></tr></table></figure>

<h2 id="2-openvpn安装"><a href="#2-openvpn安装" class="headerlink" title="2.openvpn安装"></a>2.openvpn安装</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@VPN easy-rsa]<span class="hljs-comment"># yum -y install openvpn</span><br>[root@VPN easy-rsa]<span class="hljs-comment"># rpm -ql openvpn</span><br>/etc/openvpn<br>/etc/openvpn/client<br>/etc/openvpn/server<br>/run/openvpn-client<br>/run/openvpn-server<br>/usr/lib/systemd/system/openvpn-client@.service<br>/usr/lib/systemd/system/openvpn-server@.service<br>/usr/lib/systemd/system/openvpn@.service<br>/usr/lib/tmpfiles.d/openvpn.conf<br>/usr/lib64/openvpn<br>/usr/lib64/openvpn/plugins<br>/usr/lib64/openvpn/plugins/openvpn-plugin-auth-pam.so<br>/usr/lib64/openvpn/plugins/openvpn-plugin-down-root.so<br>/usr/sbin/openvpn<br>/usr/share/doc/openvpn-2.4.12<br>/usr/share/doc/openvpn-2.4.12/AUTHORS<br>/usr/share/doc/openvpn-2.4.12/COPYING<br>/usr/share/doc/openvpn-2.4.12/COPYRIGHT.GPL<br>/usr/share/doc/openvpn-2.4.12/ChangeLog<br>/usr/share/doc/openvpn-2.4.12/Changes.rst<br>/usr/share/doc/openvpn-2.4.12/README<br>/usr/share/doc/openvpn-2.4.12/README.auth-pam<br>/usr/share/doc/openvpn-2.4.12/README.down-root<br>/usr/share/doc/openvpn-2.4.12/README.systemd<br>/usr/share/doc/openvpn-2.4.12/contrib<br>/usr/share/doc/openvpn-2.4.12/contrib/OCSP_check<br>/usr/share/doc/openvpn-2.4.12/contrib/OCSP_check/OCSP_check.sh<br>/usr/share/doc/openvpn-2.4.12/contrib/README<br>/usr/share/doc/openvpn-2.4.12/contrib/openvpn-fwmarkroute-1.00<br>/usr/share/doc/openvpn-2.4.12/contrib/openvpn-fwmarkroute-1.00/README<br>/usr/share/doc/openvpn-2.4.12/contrib/openvpn-fwmarkroute-1.00/fwmarkroute.down<br>/usr/share/doc/openvpn-2.4.12/contrib/openvpn-fwmarkroute-1.00/fwmarkroute.up<br>/usr/share/doc/openvpn-2.4.12/contrib/pull-resolv-conf<br>/usr/share/doc/openvpn-2.4.12/contrib/pull-resolv-conf/client.down<br>/usr/share/doc/openvpn-2.4.12/contrib/pull-resolv-conf/client.up<br>/usr/share/doc/openvpn-2.4.12/management-notes.txt<br>/usr/share/doc/openvpn-2.4.12/sample<br>/usr/share/doc/openvpn-2.4.12/sample/sample-config-files<br>/usr/share/doc/openvpn-2.4.12/sample/sample-config-files/README<br>/usr/share/doc/openvpn-2.4.12/sample/sample-config-files/client.conf<br>/usr/share/doc/openvpn-2.4.12/sample/sample-config-files/firewall.sh<br>/usr/share/doc/openvpn-2.4.12/sample/sample-config-files/home.up<br>/usr/share/doc/openvpn-2.4.12/sample/sample-config-files/loopback-client<br>/usr/share/doc/openvpn-2.4.12/sample/sample-config-files/loopback-server<br>/usr/share/doc/openvpn-2.4.12/sample/sample-config-files/office.up<br>/usr/share/doc/openvpn-2.4.12/sample/sample-config-files/openvpn-shutdown.sh<br>/usr/share/doc/openvpn-2.4.12/sample/sample-config-files/openvpn-startup.sh<br>/usr/share/doc/openvpn-2.4.12/sample/sample-config-files/roadwarrior-client.conf<br>/usr/share/doc/openvpn-2.4.12/sample/sample-config-files/roadwarrior-server.conf<br>/usr/share/doc/openvpn-2.4.12/sample/sample-config-files/server.conf<br>/usr/share/doc/openvpn-2.4.12/sample/sample-config-files/static-home.conf<br>/usr/share/doc/openvpn-2.4.12/sample/sample-config-files/static-office.conf<br>/usr/share/doc/openvpn-2.4.12/sample/sample-config-files/tls-home.conf<br>/usr/share/doc/openvpn-2.4.12/sample/sample-config-files/tls-office.conf<br>/usr/share/doc/openvpn-2.4.12/sample/sample-config-files/xinetd-client-config<br>/usr/share/doc/openvpn-2.4.12/sample/sample-config-files/xinetd-server-config<br>/usr/share/doc/openvpn-2.4.12/sample/sample-scripts<br>/usr/share/doc/openvpn-2.4.12/sample/sample-scripts/auth-pam.pl<br>/usr/share/doc/openvpn-2.4.12/sample/sample-scripts/bridge-start<br>/usr/share/doc/openvpn-2.4.12/sample/sample-scripts/bridge-stop<br>/usr/share/doc/openvpn-2.4.12/sample/sample-scripts/ucn.pl<br>/usr/share/doc/openvpn-2.4.12/sample/sample-scripts/verify-cn<br>/usr/share/doc/openvpn-2.4.12/sample/sample-windows<br>/usr/share/doc/openvpn-2.4.12/sample/sample-windows/sample.ovpn<br>/usr/share/man/man8/openvpn.8.gz<br>/var/lib/openvpn<br></code></pre></td></tr></table></figure>



<h1 id="二-准备证书相关文件"><a href="#二-准备证书相关文件" class="headerlink" title="二.准备证书相关文件"></a>二.准备证书相关文件</h1><h2 id="2-1安装easy-rsa"><a href="#2-1安装easy-rsa" class="headerlink" title="2.1安装easy-rsa"></a>2.1安装easy-rsa</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">安装easy-rsa</span><br>[root@VPN ~]# yum -y install easy-rsa<br><span class="hljs-meta prompt_">#</span><span class="language-bash">下面是easy-rsa安装后生成的包</span><br>[root@VPN ~]# rpm -ql easy-rsa<br>/usr/share/doc/easy-rsa-3.0.8<br>/usr/share/doc/easy-rsa-3.0.8/COPYING.md<br>/usr/share/doc/easy-rsa-3.0.8/ChangeLog<br>/usr/share/doc/easy-rsa-3.0.8/README.md<br>/usr/share/doc/easy-rsa-3.0.8/README.quickstart.md<br>/usr/share/doc/easy-rsa-3.0.8/vars.example<br>/usr/share/easy-rsa<br>/usr/share/easy-rsa/3<br>/usr/share/easy-rsa/3.0<br>/usr/share/easy-rsa/3.0.8<br>/usr/share/easy-rsa/3.0.8/easyrsa<br>/usr/share/easy-rsa/3.0.8/openssl-easyrsa.cnf<br>/usr/share/easy-rsa/3.0.8/x509-types<br>/usr/share/easy-rsa/3.0.8/x509-types/COMMON<br>/usr/share/easy-rsa/3.0.8/x509-types/ca<br>/usr/share/easy-rsa/3.0.8/x509-types/client<br>/usr/share/easy-rsa/3.0.8/x509-types/code-signing<br>/usr/share/easy-rsa/3.0.8/x509-types/email<br>/usr/share/easy-rsa/3.0.8/x509-types/kdc<br>/usr/share/easy-rsa/3.0.8/x509-types/server<br>/usr/share/easy-rsa/3.0.8/x509-types/serverClient<br>/usr/share/licenses/easy-rsa-3.0.8<br>/usr/share/licenses/easy-rsa-3.0.8/gpl-2.0.txt<br><span class="hljs-meta prompt_">#</span><span class="language-bash">将/usr/share/easy-rsa/3和vars.example复制到统一目录下，方便管理</span><br>[root@VPN ~]# mkdir -p /data/easy-rsa; cp -r /usr/share/easy-rsa/3/* /data/easy-rsa<br>[root@VPN ~]# cp -r /usr/share/doc/easy-rsa-3.0.8/vars.example /data/easy-rsa/vars<br><span class="hljs-meta prompt_">#</span><span class="language-bash">easyrsa涉及到证书的生成，vars涉及到证书的配置，所以确认一下有没有复制成功</span><br>[root@VPN ~]# ll /data/easy-rsa/<br>total 96<br>-rwxr-xr-x 1 root root 76946 Aug 24 14:43 easyrsa<br>-rw-r--r-- 1 root root  4616 Aug 24 14:43 openssl-easyrsa.cnf<br>-rw-r--r-- 1 root root  8925 Aug 24 14:44 vars<br>drwxr-xr-x 2 root root   122 Aug 24 14:43 x509-types<br></code></pre></td></tr></table></figure>

<h2 id="2-2-easyrsa脚本帮助"><a href="#2-2-easyrsa脚本帮助" class="headerlink" title="2.2 easyrsa脚本帮助"></a>2.2 easyrsa脚本帮助</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@VPN ~]# cd /data/easy-rsa/<br><span class="hljs-meta prompt_">#</span><span class="language-bash">查看easyrsa帮助</span><br>[root@VPN easy-rsa]# ./easyrsa <br><br>Note: using Easy-RSA configuration from: /data/easy-rsa/vars<br><br>Easy-RSA 3 usage and overview<br><br>USAGE: easyrsa [options] COMMAND [command-options]<br><br>A list of commands is shown below. To get detailed usage and help for a<br>command, run:<br>  ./easyrsa help COMMAND<br><br>For a listing of options that can be supplied before the command, use:<br>  ./easyrsa help options<br><br>Here is the list of commands available with a short syntax reminder. Use the<br>&#x27;help&#x27; command above to get full usage details.<br><br>  init-pki<br>  build-ca [ cmd-opts ]<br>  gen-dh<br>  gen-req &lt;filename_base&gt; [ cmd-opts ]<br>  sign-req &lt;type&gt; &lt;filename_base&gt;<br>  build-client-full &lt;filename_base&gt; [ cmd-opts ]<br>  build-server-full &lt;filename_base&gt; [ cmd-opts ]<br>  revoke &lt;filename_base&gt; [cmd-opts]<br>  renew &lt;filename_base&gt; [cmd-opts]<br>  build-serverClient-full &lt;filename_base&gt; [ cmd-opts ]<br>  gen-crl<br>  update-db<br>  show-req &lt;filename_base&gt; [ cmd-opts ]<br>  show-cert &lt;filename_base&gt; [ cmd-opts ]<br>  show-ca [ cmd-opts ]<br>  import-req &lt;request_file_path&gt; &lt;short_basename&gt;<br>  export-p7 &lt;filename_base&gt; [ cmd-opts ]<br>  export-p8 &lt;filename_base&gt; [ cmd-opts ]<br>  export-p12 &lt;filename_base&gt; [ cmd-opts ]<br>  set-rsa-pass &lt;filename_base&gt; [ cmd-opts ]<br>  set-ec-pass &lt;filename_base&gt; [ cmd-opts ]<br>  upgrade &lt;type&gt;<br><br>DIRECTORY STATUS (commands would take effect on these locations)<br>  EASYRSA: /data/easy-rsa<br>      PKI: /data/easy-rsa/pki<br></code></pre></td></tr></table></figure>

<h2 id="2-3初始化PKI生成PKI相关目录和文件"><a href="#2-3初始化PKI生成PKI相关目录和文件" class="headerlink" title="2.3初始化PKI生成PKI相关目录和文件"></a>2.3初始化PKI生成PKI相关目录和文件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">证书相关配置，修改刚刚复制到/data/easy-rsa目录下的vars文件（要取消注释）</span><br>[root@VPN easy-rsa]# vim vars<br>set_var EASYRSA_REQ_COUNTRY     &quot;CN&quot;#国家<br>set_var EASYRSA_REQ_PROVINCE    &quot;GD&quot;#省份<br>set_var EASYRSA_REQ_CITY        &quot;Shenzhen&quot;#城市<br>set_var EASYRSA_CA_EXPIRE       36500#CA证书有效期时间，单位天<br>set_var EASYRSA_CERT_EXPIRE     3650#服务器及客户端证书有效期，单位天<br><span class="hljs-meta prompt_">#</span><span class="language-bash">下面几个由于不需要所以我没有启用，可以根据自己需求启动</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">set_var EASYRSA_REQ_ORG        <span class="hljs-string">&quot;Copyleft Certificate Co&quot;</span><span class="hljs-comment">#组织</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">set_var EASYRSA_REQ_EMAIL      <span class="hljs-string">&quot;me@example.net&quot;</span><span class="hljs-comment">#邮箱</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">set_var EASYRSA_REQ_OU         <span class="hljs-string">&quot;My Organizational Unit&quot;</span>拥有者</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">set_var EASYRSA_KEY_SIZE        2048<span class="hljs-comment"># 长度</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">set_var EASYRSA_ALGO            rsa<span class="hljs-comment"># 算法</span></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">开始初始化</span><br>[root@VPN easy-rsa]# ./easyrsa init-pki<br><br>Note: using Easy-RSA configuration from: /data/easy-rsa/vars<br><br>init-pki complete; you may now create a CA or requests.<br>Your newly created PKI dir is: /data/easy-rsa/pki #这里提示增加pki目录<br><br>[root@VPN easy-rsa]# tree<br>.<br>├── easyrsa<br>├── openssl-easyrsa.cnf<br>├── pki<br>│   ├── openssl-easyrsa.cnf<br>│   ├── private#放置私钥<br>│   ├── reqs#放置证书<br>│   └── safessl-easyrsa.cnf<br>├── vars<br>└── x509-types<br>    ├── ca<br>    ├── client<br>    ├── code-signing<br>    ├── COMMON<br>    ├── email<br>    ├── kdc<br>    ├── server<br>    └── serverClient<br><br>4 directories, 13 files<br></code></pre></td></tr></table></figure>

<h3 id="2-4创建CA机构环境"><a href="#2-4创建CA机构环境" class="headerlink" title="2.4创建CA机构环境"></a>2.4创建CA机构环境</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">生成CA证书，这里我选择了加密</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">./easyrsa build-ca nopass 不加密跟上nopass,生产环境推荐使用加密</span><br>[root@VPN easy-rsa]# ./easyrsa build-ca<br><br>Note: using Easy-RSA configuration from: /data/easy-rsa/vars<br>Using SSL: openssl OpenSSL 1.0.2k-fips  26 Jan 2017<br><br>Enter New CA Key Passphrase: <br>Re-Enter New CA Key Passphrase: <br>Generating RSA private key, 2048 bit long modulus<br>............+++<br>...............+++<br>e is 65537 (0x10001)<br>You are about to be asked to enter information that will be incorporated<br>into your certificate request.<br>What you are about to enter is what is called a Distinguished Name or a DN.<br>There are quite a few fields but you can leave some blank<br>For some fields there will be a default value,<br>If you enter &#x27;.&#x27;, the field will be left blank.<br>-----<br>Common Name (eg: your user, host, or server name) [Easy-RSA CA]:<br><span class="hljs-meta prompt_">#</span><span class="language-bash">这里可以自己设置名称，不设置则直接回车即可</span><br>CA creation complete and you may now import and sign cert requests.<br>Your new CA certificate file for publishing is at:<br>/data/easy-rsa/pki/ca.crt<br><br>[root@VPN easy-rsa]# tree<br>.<br>├── easyrsa<br>├── openssl-easyrsa.cnf<br>├── pki<br>│   ├── ca.crt #CA创建成功<br>│   ├── certs_by_serial<br>│   ├── index.txt<br>│   ├── index.txt.attr<br>│   ├── issued<br>│   ├── openssl-easyrsa.cnf<br>│   ├── private<br>│   │   └── ca.key #CA私钥<br>│   ├── renewed<br>│   │   ├── certs_by_serial<br>│   │   ├── private_by_serial<br>│   │   └── reqs_by_serial<br>│   ├── reqs<br>│   ├── revoked<br>│   │   ├── certs_by_serial<br>│   │   ├── private_by_serial<br>│   │   └── reqs_by_serial<br>│   ├── safessl-easyrsa.cnf<br>│   └── serial<br>├── vars<br>└── x509-types<br>    ├── ca<br>    ├── client<br>    ├── code-signing<br>    ├── COMMON<br>    ├── email<br>    ├── kdc<br>    ├── server<br>    └── serverClient<br><br>14 directories, 18 files<br><br></code></pre></td></tr></table></figure>

<h3 id="2-5创建服务端证书"><a href="#2-5创建服务端证书" class="headerlink" title="2.5创建服务端证书"></a>2.5创建服务端证书</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#后续默认就是加密，不需要加密则跟上nopass</span><br>[root@VPN easy-rsa]<span class="hljs-comment"># ./easyrsa gen-req server </span><br><br>Note: using Easy-RSA configuration from: /data/easy-rsa/vars<br>Using SSL: openssl OpenSSL 1.0.2k-fips  26 Jan 2017<br>Generating a 2048 bit RSA private key<br>.....................................+++<br>....+++<br>writing new private key to <span class="hljs-string">&#x27;/data/easy-rsa/pki/easy-rsa-24342.8lAGvJ/tmp.htRVAo&#x27;</span><br>Enter PEM pass phrase:<br>Verifying - Enter PEM pass phrase:<br>Verify failure<br>Enter PEM pass phrase:<br>Verifying - Enter PEM pass phrase:<br>-----<br>You are about to be asked to enter information that will be incorporated<br>into your certificate request.<br>What you are about to enter is what is called a Distinguished Name or a DN.<br>There are quite a few fields but you can leave some blank<br>For some fields there will be a default value,<br>If you enter <span class="hljs-string">&#x27;.&#x27;</span>, the field will be left blank.<br>-----<br>Common Name (eg: your user, host, or server name) [server]:<span class="hljs-comment">#默认回车</span><br><br>Keypair and certificate request completed. Your files are:<br>req: /data/easy-rsa/pki/reqs/server.req<br>key: /data/easy-rsa/pki/private/server.key<br><br>[root@VPN easy-rsa]<span class="hljs-comment"># tree pki/</span><br>pki/<br>├── ca.crt<br>├── certs_by_serial<br>├── index.txt<br>├── index.txt.attr<br>├── issued<br>├── openssl-easyrsa.cnf<br>├── private<br>│   ├── ca.key<br>│   └── server.key <span class="hljs-comment">#私钥</span><br>├── renewed<br>│   ├── certs_by_serial<br>│   ├── private_by_serial<br>│   └── reqs_by_serial<br>├── reqs<br>│   └── server.req <span class="hljs-comment">#证书申请文件</span><br>├── revoked<br>│   ├── certs_by_serial<br>│   ├── private_by_serial<br>│   └── reqs_by_serial<br>├── safessl-easyrsa.cnf<br>└── serial<br><br>12 directories, 9 files<br></code></pre></td></tr></table></figure>

<h3 id="2-6颁发服务端证书"><a href="#2-6颁发服务端证书" class="headerlink" title="2.6颁发服务端证书"></a>2.6颁发服务端证书</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#第一个server表示证书的类型,第二个server表示请求文件名的前缀</span><br>[root@VPN easy-rsa]<span class="hljs-comment"># ./easyrsa sign server server</span><br><br>Note: using Easy-RSA configuration from: /data/easy-rsa/vars<br>Using SSL: openssl OpenSSL 1.0.2k-fips  26 Jan 2017<br><br><br>You are about to sign the following certificate.<br>Please check over the details shown below <span class="hljs-keyword">for</span> accuracy. Note that this request<br>has not been cryptographically verified. Please be sure it came from a trusted<br><span class="hljs-built_in">source</span> or that you have verified the request checksum with the sender.<br><br>Request subject, to be signed as a server certificate <span class="hljs-keyword">for</span> 3650 days:<br><br>subject=<br>    commonName                = server<br><br><br>Type the word <span class="hljs-string">&#x27;yes&#x27;</span> to <span class="hljs-built_in">continue</span>, or any other input to abort.<br>  Confirm request details: <span class="hljs-built_in">yes</span><span class="hljs-comment">#这里需要输入yes，有CA密码则输入密码</span><br>Using configuration from /data/easy-rsa/pki/easy-rsa-24375.ERrQu2/tmp.ScoPp8<br>Enter pass phrase <span class="hljs-keyword">for</span> /data/easy-rsa/pki/private/ca.key:<br>Check that the request matches the signature<br>Signature ok<br>The Subject<span class="hljs-string">&#x27;s Distinguished Name is as follows</span><br><span class="hljs-string">commonName            :ASN.1 12:&#x27;</span>server<span class="hljs-string">&#x27;</span><br><span class="hljs-string">Certificate is to be certified until Aug 21 11:58:52 2032 GMT (3650 days)</span><br><span class="hljs-string"></span><br><span class="hljs-string">Write out database with 1 new entries</span><br><span class="hljs-string">Data Base Updated</span><br><span class="hljs-string"></span><br><span class="hljs-string">Certificate created at: /data/easy-rsa/pki/issued/server.crt</span><br><span class="hljs-string"></span><br><span class="hljs-string">[root@VPN easy-rsa]# tree pki/</span><br><span class="hljs-string">pki/</span><br><span class="hljs-string">├── ca.crt</span><br><span class="hljs-string">├── certs_by_serial</span><br><span class="hljs-string">│   └── E5AE0001EC2BED6FDB8730D0E1B7ED73.pem #这个跟server本质是一样的</span><br><span class="hljs-string">├── index.txt #index.txt可以看到颁发证书的原数据，有兴趣可以通过cat看下</span><br><span class="hljs-string">├── index.txt.attr</span><br><span class="hljs-string">├── index.txt.attr.old</span><br><span class="hljs-string">├── index.txt.old</span><br><span class="hljs-string">├── issued</span><br><span class="hljs-string">│   └── server.crt #服务器证书</span><br><span class="hljs-string">├── openssl-easyrsa.cnf</span><br><span class="hljs-string">├── private</span><br><span class="hljs-string">│   ├── ca.key</span><br><span class="hljs-string">│   └── server.key</span><br><span class="hljs-string">├── renewed</span><br><span class="hljs-string">│   ├── certs_by_serial</span><br><span class="hljs-string">│   ├── private_by_serial</span><br><span class="hljs-string">│   └── reqs_by_serial</span><br><span class="hljs-string">├── reqs</span><br><span class="hljs-string">│   └── server.req</span><br><span class="hljs-string">├── revoked</span><br><span class="hljs-string">│   ├── certs_by_serial</span><br><span class="hljs-string">│   ├── private_by_serial</span><br><span class="hljs-string">│   └── reqs_by_serial</span><br><span class="hljs-string">├── safessl-easyrsa.cnf</span><br><span class="hljs-string">├── serial</span><br><span class="hljs-string">└── serial.old</span><br><span class="hljs-string"></span><br><span class="hljs-string">12 directories, 14 files</span><br></code></pre></td></tr></table></figure>

<h3 id="2-7创建Diffie-Hellman密钥"><a href="#2-7创建Diffie-Hellman密钥" class="headerlink" title="2.7创建Diffie-Hellman密钥"></a>2.7创建Diffie-Hellman密钥</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@VPN easy-rsa]<span class="hljs-comment"># ./easyrsa gen-dh</span><br><br>Note: using Easy-RSA configuration from: /data/easy-rsa/vars<br>Using SSL: openssl OpenSSL 1.0.2k-fips  26 Jan 2017<br>Generating DH parameters, 2048 bit long safe prime, generator 2<br>This is going to take a long time<br>......................................................................................................................................................+....................+.......+.......................................................................................................................................................+...................................................................................................................................................................+.................................................................................................................................................................................................................................+......................................................................................................................................................................................................................................................................+.......................................................................................................................................................................................................+.........+................+..............................................................................................................................................+...............................................................+..................................+........................+..............+................................................................................+.....+...................................................................+.......................................................................................................................................................................................+...................................................................................+.............................................................................................................................................+....................................................................................+............................................................+................................+..................................................................+...+...................................................................................+................+..................................................................................................................+.+...+..................................................................................................++*++*<br><br>DH parameters of size 2048 created at /data/easy-rsa/pki/dh.pem<br><br>[root@VPN easy-rsa]<span class="hljs-comment"># tree pki/</span><br>pki/<br>├── ca.crt<br>├── certs_by_serial<br>│   └── E5AE0001EC2BED6FDB8730D0E1B7ED73.pem<br>├── dh.pem <span class="hljs-comment">#密钥文件</span><br>├── index.txt<br>├── index.txt.attr<br>├── index.txt.attr.old<br>├── index.txt.old<br>├── issued<br>│   └── server.crt<br>├── openssl-easyrsa.cnf<br>├── private<br>│   ├── ca.key<br>│   └── server.key<br>├── renewed<br>│   ├── certs_by_serial<br>│   ├── private_by_serial<br>│   └── reqs_by_serial<br>├── reqs<br>│   └── server.req<br>├── revoked<br>│   ├── certs_by_serial<br>│   ├── private_by_serial<br>│   └── reqs_by_serial<br>├── safessl-easyrsa.cnf<br>├── serial<br>└── serial.old<br><br>12 directories, 15 files<br></code></pre></td></tr></table></figure>

<h3 id="2-8准备客户端证书环境"><a href="#2-8准备客户端证书环境" class="headerlink" title="2.8准备客户端证书环境"></a>2.8准备客户端证书环境</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@VPN easy-rsa]<span class="hljs-comment"># ./easyrsa gen-req test</span><br><br>Note: using Easy-RSA configuration from: /data/easy-rsa/vars<br>Using SSL: openssl OpenSSL 1.0.2k-fips  26 Jan 2017<br>Generating a 2048 bit RSA private key<br>......................................+++<br>.................+++<br>writing new private key to <span class="hljs-string">&#x27;/data/easy-rsa/pki/easy-rsa-24477.61A7O3/tmp.UkTGIK&#x27;</span><br>Enter PEM pass phrase:<br>Verifying - Enter PEM pass phrase:<br>-----<br>You are about to be asked to enter information that will be incorporated<br>into your certificate request.<br>What you are about to enter is what is called a Distinguished Name or a DN.<br>There are quite a few fields but you can leave some blank<br>For some fields there will be a default value,<br>If you enter <span class="hljs-string">&#x27;.&#x27;</span>, the field will be left blank.<br>-----<br>Common Name (eg: your user, host, or server name) [<span class="hljs-built_in">test</span>]:<span class="hljs-comment">#回车接受默认值</span><br><br>Keypair and certificate request completed. Your files are:<br>req: /data/easy-rsa/pki/reqs/test.req<br>key: /data/easy-rsa/pki/private/test.key<br><br>[root@VPN easy-rsa]<span class="hljs-comment"># tree pki/</span><br>pki/<br>├── ca.crt<br>├── certs_by_serial<br>│   └── E5AE0001EC2BED6FDB8730D0E1B7ED73.pem<br>├── dh.pem<br>├── index.txt<br>├── index.txt.attr<br>├── index.txt.attr.old<br>├── index.txt.old<br>├── issued<br>│   └── server.crt<br>├── openssl-easyrsa.cnf<br>├── private<br>│   ├── ca.key<br>│   ├── server.key<br>│   └── test.key <span class="hljs-comment">#客户端密钥</span><br>├── renewed<br>│   ├── certs_by_serial<br>│   ├── private_by_serial<br>│   └── reqs_by_serial<br>├── reqs<br>│   ├── server.req<br>│   └── test.req <span class="hljs-comment">#客户端申请文件</span><br>├── revoked<br>│   ├── certs_by_serial<br>│   ├── private_by_serial<br>│   └── reqs_by_serial<br>├── safessl-easyrsa.cnf<br>├── serial<br>└── serial.old<br></code></pre></td></tr></table></figure>

<h3 id="2-9颁发客户端证书"><a href="#2-9颁发客户端证书" class="headerlink" title="2.9颁发客户端证书"></a>2.9颁发客户端证书</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@VPN easy-rsa]<span class="hljs-comment"># ./easyrsa sign client test</span><br><br>Note: using Easy-RSA configuration from: /data/easy-rsa/vars<br>Using SSL: openssl OpenSSL 1.0.2k-fips  26 Jan 2017<br><br><br>You are about to sign the following certificate.<br>Please check over the details shown below <span class="hljs-keyword">for</span> accuracy. Note that this request<br>has not been cryptographically verified. Please be sure it came from a trusted<br><span class="hljs-built_in">source</span> or that you have verified the request checksum with the sender.<br><br>Request subject, to be signed as a client certificate <span class="hljs-keyword">for</span> 365 days:<br><br>subject=<br>    commonName                = <span class="hljs-built_in">test</span><br><br><br>Type the word <span class="hljs-string">&#x27;yes&#x27;</span> to <span class="hljs-built_in">continue</span>, or any other input to abort.<br>  Confirm request details: <span class="hljs-built_in">yes</span><br>Using configuration from /data/easy-rsa/pki/easy-rsa-24531.6AY1Oj/tmp.YVcoA3<br>Enter pass phrase <span class="hljs-keyword">for</span> /data/easy-rsa/pki/private/ca.key:<br>Check that the request matches the signature<br>Signature ok<br>The Subject<span class="hljs-string">&#x27;s Distinguished Name is as follows</span><br><span class="hljs-string">commonName            :ASN.1 12:&#x27;</span><span class="hljs-built_in">test</span><span class="hljs-string">&#x27;</span><br><span class="hljs-string">Certificate is to be certified until Aug 24 12:51:00 2023 GMT (365 days)</span><br><span class="hljs-string"></span><br><span class="hljs-string">Write out database with 1 new entries</span><br><span class="hljs-string">Data Base Updated</span><br><span class="hljs-string"></span><br><span class="hljs-string">Certificate created at: /data/easy-rsa/pki/issued/test.crt</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure>

<h3 id="2-10将CA和服务器证书相关文件复制到服务器对应的目录"><a href="#2-10将CA和服务器证书相关文件复制到服务器对应的目录" class="headerlink" title="2.10将CA和服务器证书相关文件复制到服务器对应的目录"></a>2.10将CA和服务器证书相关文件复制到服务器对应的目录</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#创建一个目录用于存放服务器端证书，该目录可随意命名</span><br>[root@VPN easy-rsa]<span class="hljs-comment"># mkdir /etc/openvpn/certs</span><br><span class="hljs-comment">#将下面四个文件复制到刚刚创建的目录下</span><br>[root@VPN easy-rsa]<span class="hljs-comment"># cp pki/ca.crt pki/dh.pem pki/issued/server.crt pki/private/server.key /etc/openvpn/certs/</span><br>[root@VPN easy-rsa]<span class="hljs-comment"># ll /etc/openvpn/certs/</span><br>total 20<br>-rw------- 1 root root 1176 Aug 24 21:08 ca.crt<br>-rw------- 1 root root  424 Aug 24 21:08 dh.pem<br>-rw------- 1 root root 4552 Aug 24 21:08 server.crt<br>-rw------- 1 root root 1834 Aug 24 21:08 server.key<br><br></code></pre></td></tr></table></figure>

<h3 id="2-11将客户端私钥与证书相关文件复制到服务器相关的目录"><a href="#2-11将客户端私钥与证书相关文件复制到服务器相关的目录" class="headerlink" title="2.11将客户端私钥与证书相关文件复制到服务器相关的目录"></a>2.11将客户端私钥与证书相关文件复制到服务器相关的目录</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#创建一个目录用于存放服务器端证书，该目录命名必须与刚刚颁发的用户一致</span><br>[root@VPN easy-rsa]<span class="hljs-comment"># mkdir /etc/openvpn/client/test</span><br><br>[root@VPN easy-rsa]<span class="hljs-comment"># cp pki/ca.crt pki/issued/test.crt pki/private/test.key /etc/openvpn/client/test/</span><br>[root@VPN easy-rsa]<span class="hljs-comment"># ll /etc/openvpn/client/test/</span><br>total 12<br>-rw------- 1 root root 1176 Aug 24 21:13 ca.crt<br>-rw------- 1 root root 1834 Aug 24 21:13 test.key<br>-rw------- 1 root root  883 Aug 24 21:13 test.ctr<br></code></pre></td></tr></table></figure>

<p>三、准备OpenVPN服务器配置文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#配置参数说明</span><br><span class="hljs-comment">#参考：/usr/share/doc/openvpn-2.4.12/sample/sample-config-files/server.conf</span><br>[root@VPN easy-rsa]<span class="hljs-comment"># vim /etc/openvpn/server.conf</span><br>port 1194 <span class="hljs-comment">#openvpn监听端口</span><br>proto tcp <span class="hljs-comment">#使用的协议</span><br>dev tun <span class="hljs-comment">#启动openvpn后自动生成的网卡</span><br>ca /etc/openvpn/certs/ca.crt <span class="hljs-comment">#CA证书文件路径</span><br>cert /etc/openvpn/certs/server.crt <span class="hljs-comment">#服务器证书文件路径</span><br>key /etc/openvpn/certs/server.key <span class="hljs-comment">#私钥文件路径</span><br>dh /etc/openvpn/certs/dh.pem <span class="hljs-comment">#dh文件路径</span><br>server 10.8.0.0 255.255.255.0 <span class="hljs-comment">#给客户端使用的地址池，openvpn默认会保留地址池中的第一个地址</span><br>push <span class="hljs-string">&quot;route 172.30.0.0 255.255.255.0&quot;</span> <span class="hljs-comment">#路由记录，多条路由写多个push记录</span><br>keepalive 10 120 <span class="hljs-comment">#状态检测，每10秒检查连接状态，120秒没有连接则会断开</span><br>cipher AES-256-CBC <span class="hljs-comment">#加密算法</span><br>compress lz4-v2 <span class="hljs-comment">#压缩</span><br>push <span class="hljs-string">&quot;compress lz4-v2&quot;</span> <span class="hljs-comment">#推送客户端使用压缩算法</span><br>max-clients 2048 <span class="hljs-comment">#同时最多可支持多少用户连接openvpn</span><br>user openvpn <span class="hljs-comment">#账号用于启动openvpn，安装openvpn时会自动创建</span><br>group openvpn <span class="hljs-comment">#组用于启动openvpn，安装openvpn时会自动创建</span><br>status /var/log/openvpn/openvpn-status.log <span class="hljs-comment">#日志信息</span><br>log-append /var/log/openvpn/openvpn.log <span class="hljs-comment">#日志信息</span><br>verb 3 <span class="hljs-comment">#日志详细程度，0-9根据需求设置</span><br>mute 20 <span class="hljs-comment">#相同类别的信息只记录前20条到日志文件中</span><br><br><span class="hljs-comment">#准备日志相关目录</span><br>[root@VPN easy-rsa]<span class="hljs-comment"># mkdir /var/log/openvpn</span><br>[root@VPN easy-rsa]<span class="hljs-comment"># chown openvpn. /var/log/openvpn</span><br>[root@VPN easy-rsa]<span class="hljs-comment"># ll -d /var/log/openvpn</span><br>drwxr-xr-x 2 openvpn openvpn 6 Aug 24 21:58 /var/log/openvpn<br></code></pre></td></tr></table></figure>

<h1 id="三、启动OpenVPN"><a href="#三、启动OpenVPN" class="headerlink" title="三、启动OpenVPN"></a>三、启动OpenVPN</h1><h2 id="1-启动openvpn服务"><a href="#1-启动openvpn服务" class="headerlink" title="1.启动openvpn服务"></a>1.启动openvpn服务</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#查看系统是否生成server文件，centos8及rocky8以上版本不会自动生成</span><br>[root@VPN easy-rsa]<span class="hljs-comment"># rpm -ql openvpn | grep systemd</span><br>/usr/lib/systemd/system/openvpn-client@.service<br>/usr/lib/systemd/system/openvpn-server@.service<br>/usr/lib/systemd/system/openvpn@.service<br>/usr/share/doc/openvpn-2.4.12/README.systemd<br><br><span class="hljs-comment">#启动openvpn，并设置开启启动</span><br>[root@VPN easy-rsa]<span class="hljs-comment"># systemctl daemon-reload</span><br>[root@VPN easy-rsa]<span class="hljs-comment"># systemctl enable --now openvpn@server</span><br><span class="hljs-comment">#查看服务状态</span><br>[root@VPN ~]<span class="hljs-comment"># systemctl status openvpn@server</span><br>● openvpn@server.service - OpenVPN Robust And Highly Flexible Tunneling Application On server<br>   Loaded: loaded (/usr/lib/systemd/system/openvpn@.service; enabled; vendor preset: disabled)<br>   Active: active (running) since Wed 2022-08-24 22:52:37 +08; 2min 22s ago<br> Main PID: 849 (openvpn)<br>   Status: <span class="hljs-string">&quot;Initialization Sequence Completed&quot;</span><br>   CGroup: /system.slice/system-openvpn.slice/openvpn@server.service<br>           └─849 /usr/sbin/openvpn --<span class="hljs-built_in">cd</span> /etc/openvpn/ --config server.con...<br><br>Aug 24 22:52:37 VPN systemd[1]: Starting OpenVPN Robust And Highly Flex.....<br>Aug 24 22:52:37 VPN systemd[1]: Started OpenVPN Robust And Highly Flexi...r.<br>Hint: Some lines were ellipsized, use -l to show <span class="hljs-keyword">in</span> full.<br><br>[root@VPN ~]<span class="hljs-comment"># ss -ntl</span><br>State      Recv-Q Send-Q Local Address:Port               Peer Address:Port              <br>LISTEN     0      100    127.0.0.1:25                     *:*                  <br>LISTEN     0      32         *:1194                   *:*                  <br>LISTEN     0      128        *:22                     *:*                  <br>LISTEN     0      100    [::1]:25                  [::]:*                  <br>LISTEN     0      128     [::]:22                  [::]:*<br><br>[root@VPN ~]<span class="hljs-comment"># ip a</span><br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: ens18: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether fe:<span class="hljs-built_in">fc</span>:fe:5d:fb:2b brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.1.199/24 brd 192.168.1.255 scope global noprefixroute ens18<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::4c92:458f:544c:7e06/64 scope <span class="hljs-built_in">link</span> noprefixroute <br>       valid_lft forever preferred_lft forever<br>3: tun0: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 100<br>    <span class="hljs-built_in">link</span>/none <br>    inet 10.127.0.1 peer 10.127.0.2/32 scope global tun0<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::576b:e0a7:7693:69a9/64 scope <span class="hljs-built_in">link</span> flags 800 <br>       valid_lft forever preferred_lft forever<br><br></code></pre></td></tr></table></figure>

<h2 id="2-准备openvpn客户端配置文件"><a href="#2-准备openvpn客户端配置文件" class="headerlink" title="2.准备openvpn客户端配置文件"></a>2.准备openvpn客户端配置文件</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#生成客户端文件,文件后缀必须为.ovpn</span><br><span class="hljs-comment">#修改配置文件,内容如下</span><br>[root@centos8 ~]<span class="hljs-comment">#vim /etc/openvpn/client/test/client.ovpn</span><br>client <span class="hljs-comment">#客户端</span><br>dev tun <span class="hljs-comment">#和服务器端保持一致</span><br>proto tcp <span class="hljs-comment">#和服务器端保持一致</span><br>remote 10.0.0.8 1194 <span class="hljs-comment">#生产中为OpenVPN公网IP或者FQDN</span><br>resolv-retry infinite <span class="hljs-comment">#地址解析，如果地址发生变化会自动进行解析</span><br>nobind<br>ca ca.crt <span class="hljs-comment">#CA文件</span><br>cert test.crt <span class="hljs-comment">#证书</span><br>key test.key<span class="hljs-comment">#私钥</span><br>remote-cert-tls server <span class="hljs-comment">#远程服务器证书</span><br>cipher AES-256-CBC <span class="hljs-comment">#加密算法</span><br>verb 3 <span class="hljs-comment">#此项需要和服务器端保持一致,否则无法通信</span><br>compress lz4-v2 <span class="hljs-comment">#此项需要和服务器端保持一致,如不指定,默认使用comp-lz压缩</span><br><br>[root@VPN ~]<span class="hljs-comment"># cd /etc/openvpn/client/test</span><br>[root@VPN <span class="hljs-built_in">test</span>]<span class="hljs-comment"># ll</span><br>total 16<br>-rw------- 1 root root 1176 Aug 24 21:13 ca.crt<br>-rw-r--r-- 1 root root  249 Aug 24 23:22 client.ovpn<br>-rw------- 1 root root 1834 Aug 24 21:13 test.key<br>-rw------- 1 root root  883 Aug 24 21:13 test.cte<br>[root@VPN <span class="hljs-built_in">test</span>]<span class="hljs-comment"># zip /root/test.zip *</span><br>  adding: ca.crt (deflated 26%)<br>  adding: client.ovpn (deflated 28%)<br>  adding: test.key (deflated 24%)<br>  adding: test.req (deflated 23%)<br><span class="hljs-comment">#可以通过xshell的文件传输或sz命令将刚刚打包的文件发送到Windows</span><br>[root@VPN <span class="hljs-built_in">test</span>]<span class="hljs-comment"># sz /root/test.zip  </span><br>  <br></code></pre></td></tr></table></figure>

<h1 id="四、实现-OpenVPN-客户端"><a href="#四、实现-OpenVPN-客户端" class="headerlink" title="四、实现 OpenVPN 客户端"></a>四、实现 OpenVPN 客户端</h1><h2 id="1-Windows-配置部署-OpenVPN-客户端"><a href="#1-Windows-配置部署-OpenVPN-客户端" class="headerlink" title="1.Windows 配置部署 OpenVPN 客户端"></a>1.Windows 配置部署 OpenVPN 客户端</h2><p>下载地址：<a target="_blank" rel="noopener" href="https://openvpn.net/community-downloads/">Community Downloads | OpenVPN</a></p>
<p><img src="C:\Users\zhangk\blog\source_posts\centos7部署openvpn\image-20220825164214339.png" srcset="/img/loading.gif" lazyload alt="image-20220825164214339"></p>
<p>openvpn客户端安装过程：</p>
<p><img src="C:\Users\zhangk\blog\source_posts\centos7部署openvpn\image-20220824234102001.png" srcset="/img/loading.gif" lazyload alt="image-20220824234102001"></p>
<p><img src="C:\Users\zhangk\blog\source_posts\centos7部署openvpn\image-20220824234244443.png" srcset="/img/loading.gif" lazyload alt="image-20220824234244443"></p>
<p>安装完成后会提示没有读取配置文件，这是正常的</p>
<p><img src="C:\Users\zhangk\blog\source_posts\centos7部署openvpn\image-20220824234301566.png" srcset="/img/loading.gif" lazyload alt="image-20220824234301566"></p>
<h3 id="1-1Windows-客户端配置准备"><a href="#1-1Windows-客户端配置准备" class="headerlink" title="1.1Windows 客户端配置准备"></a>1.1Windows 客户端配置准备</h3><p>客户端默认安装路径：C:\Program Files\OpenVPN\config，将刚刚压缩的文件解压到该目录下</p>
<p><img src="C:\Users\zhangk\blog\source_posts\centos7部署openvpn\image-20220824235752859.png" srcset="/img/loading.gif" lazyload alt="image-20220824235752859"></p>
<p><img src="C:\Users\zhangk\blog\source_posts\centos7部署openvpn\image-20220825000006331.png" srcset="/img/loading.gif" lazyload alt="image-20220825000006331"></p>
<p>双击打开，然后在在状态栏显示以下图标,右键点连接</p>
<p><img src="C:\Users\zhangk\blog\source_posts\centos7部署openvpn\image-20220825000039228.png" srcset="/img/loading.gif" lazyload alt="image-20220825000039228"></p>
<p><img src="C:\Users\zhangk\blog\source_posts\centos7部署openvpn\image-20220825000058164.png" srcset="/img/loading.gif" lazyload alt="image-20220825000058164"></p>
<p><img src="C:\Users\zhangk\blog\source_posts\centos7部署openvpn\image-20220825000128748.png" srcset="/img/loading.gif" lazyload alt="image-20220825000128748"></p>
<p><img src="C:\Users\zhangk\blog\source_posts\centos7部署openvpn\image-20220825000141848.png" srcset="/img/loading.gif" lazyload alt="image-20220825000141848"></p>
<h3 id="1-2Windows-客户端验证通信"><a href="#1-2Windows-客户端验证通信" class="headerlink" title="1.2Windows 客户端验证通信"></a>1.2Windows 客户端验证通信</h3><p><img src="C:\Users\zhangk\blog\source_posts\centos7部署openvpn\image-20220825000321994.png" srcset="/img/loading.gif" lazyload alt="image-20220825000321994"></p>
<p><img src="C:\Users\zhangk\blog\source_posts\centos7部署openvpn\image-20220825164747383.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="1-3验证OpenVPN服务器连接状态"><a href="#1-3验证OpenVPN服务器连接状态" class="headerlink" title="1.3验证OpenVPN服务器连接状态"></a>1.3验证OpenVPN服务器连接状态</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@VPN <span class="hljs-built_in">test</span>]<span class="hljs-comment"># ss -nt</span><br>State      Recv-Q Send-Q                                 Local Address:Port                                                Peer Address:Port              <br>ESTAB      0      0                                      192.168.1.199:1194                                                10.1.100.240:10284              <br>ESTAB      0      36                                     192.168.1.199:22                                                   192.168.2.1:55585              <br>ESTAB      0      0                                      192.168.1.199:22                                                   192.168.2.1:55633<br></code></pre></td></tr></table></figure>

<h1 id="五、实现访问VPN服务器的内网主机"><a href="#五、实现访问VPN服务器的内网主机" class="headerlink" title="五、实现访问VPN服务器的内网主机"></a>五、实现访问VPN服务器的内网主机</h1><h2 id="5-1OpenVPN服务器打开-ip-forward功能"><a href="#5-1OpenVPN服务器打开-ip-forward功能" class="headerlink" title="5.1OpenVPN服务器打开 ip_forward功能"></a>5.1OpenVPN服务器打开 ip_forward功能</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#在服务器开启ip_forward转发功能</span><br>[root@centos8 ~]<span class="hljs-comment">#echo net.ipv4.ip_forward = 1 &gt;&gt; /etc/sysctl.conf</span><br>[root@centos8 ~]<span class="hljs-comment">#sysctl -p</span><br>net.ipv4.ip_forward = 1<br></code></pre></td></tr></table></figure>

<h2 id="5-2配置实现内网服务器回应外网的请求的路由"><a href="#5-2配置实现内网服务器回应外网的请求的路由" class="headerlink" title="5.2配置实现内网服务器回应外网的请求的路由"></a>5.2配置实现内网服务器回应外网的请求的路由</h2><h3 id="5-2-1在内网每个主机上添加路由"><a href="#5-2-1在内网每个主机上添加路由" class="headerlink" title="5.2.1在内网每个主机上添加路由"></a>5.2.1在内网每个主机上添加路由</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#这里不是在宿主机添加</span><br>[root@zabbix ~]<span class="hljs-comment"># route add -net 10.8.0.0/24 gw 192.168.1.199</span><br></code></pre></td></tr></table></figure>

<h3 id="5-2-2在OpenVPN服务器配置-iptables-规则"><a href="#5-2-2在OpenVPN服务器配置-iptables-规则" class="headerlink" title="5.2.2在OpenVPN服务器配置 iptables 规则"></a>5.2.2在OpenVPN服务器配置 iptables 规则</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@VPN <span class="hljs-built_in">test</span>]<span class="hljs-comment"># iptables -t nat -A POSTROUTING -s 10.8.0.0/24 ! -d 10.8.0.0/24 -j SNAT --to 192.168.1.199</span><br><br>[root@VPN <span class="hljs-built_in">test</span>]<span class="hljs-comment"># iptables -vnL -t nat</span><br>Chain PREROUTING (policy ACCEPT 1116 packets, 191K bytes)<br> pkts bytes target     prot opt <span class="hljs-keyword">in</span>     out     <span class="hljs-built_in">source</span>               destination         <br><br>Chain INPUT (policy ACCEPT 964 packets, 172K bytes)<br> pkts bytes target     prot opt <span class="hljs-keyword">in</span>     out     <span class="hljs-built_in">source</span>               destination         <br><br>Chain OUTPUT (policy ACCEPT 68 packets, 5168 bytes)<br> pkts bytes target     prot opt <span class="hljs-keyword">in</span>     out     <span class="hljs-built_in">source</span>               destination         <br><br>Chain POSTROUTING (policy ACCEPT 68 packets, 5168 bytes)<br> pkts bytes target     prot opt <span class="hljs-keyword">in</span>     out     <span class="hljs-built_in">source</span>               destination         <br>    4   240 SNAT       all  --  *      *       10.8.0.0/24       !10.8.0.0/24        to:192.168.1.199<br>[root@VPN <span class="hljs-built_in">test</span>]<span class="hljs-comment"># echo &#x27;iptables -t nat -A POSTROUTING -s 10.8.0.0/24 ! -d 10.8.0.0/24 -j SNAT --to 192.168.1.199&#x27; &gt;&gt; /etc/rc.d/rc.local</span><br></code></pre></td></tr></table></figure>

<h1 id="VPN基本就搭建完成了！"><a href="#VPN基本就搭建完成了！" class="headerlink" title="VPN基本就搭建完成了！"></a>VPN基本就搭建完成了！</h1><h1 id="六、拓展资料，根据需求配置"><a href="#六、拓展资料，根据需求配置" class="headerlink" title="六、拓展资料，根据需求配置"></a>六、拓展资料，根据需求配置</h1><h2 id="1-如何给客户端指定配置，比如不同的客户端不同的ip地址、推送不同路由等"><a href="#1-如何给客户端指定配置，比如不同的客户端不同的ip地址、推送不同路由等" class="headerlink" title="1.如何给客户端指定配置，比如不同的客户端不同的ip地址、推送不同路由等"></a>1.如何给客户端指定配置，比如不同的客户端不同的ip地址、推送不同路由等</h2><p>先在server.conf中指定 client-config-dir目录，能够让openvpn访问的到</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#/etc/openvpn/路径下创建ccd目录</span><br>[root@VPN ~]<span class="hljs-comment"># mkdir /etc/openvpn/ccd</span><br><span class="hljs-comment">#配置openvpn，编辑/etc/openvpn/server.conf文件，添加如下：</span><br>client-config-dir /etc/openvpn/ccd        <span class="hljs-comment">#  确保/etc/openvpn/ccd存在</span><br><br>[root@VPN ~]<span class="hljs-comment"># cat /etc/openvpn/server.conf | grep &quot;client-config-dir /etc/openvpn/ccd&quot;</span><br>client-config-dir /etc/openvpn/ccd<br><br><br><br><span class="hljs-comment">#在/etc/openvpn/ccd目录下编辑一个与客户端同名的文件，比如想给vpnclient的这个客户端指定配置，那么就是/etc/openvpn/ccd/vpnclient，这些配置可以是</span><br>ifconfig-push 10.8.0.5 10.8.0.6       <span class="hljs-comment"># 指定客户端的IP地址，如果想固定客户端的ip可以这样做</span><br>push <span class="hljs-string">&quot;route 172.16.0.0 255.255.255.0&quot;</span>  <span class="hljs-comment"># 推送指定的路由，不同的客户端推送不同的路由可以这样做 </span><br>iroute 172.16.20.0 255.255.255.0       <span class="hljs-comment"># 忽略路由</span><br>push <span class="hljs-string">&quot;dhcp-option DNS 202.96.128.166&quot;</span>  <span class="hljs-comment"># 推送DNS</span><br>..........<br><br>特别注意：<br>ifconfig-push中的每一对IP地址表示虚拟客户端和服务器的IP端点。它们必须从连续的/30子网网段中获取(这里是/30表示xxx.xxx.xxx.xxx/30，即子网掩码位数为30)，以便于与Windows客户端和TAP-Windows驱动兼容。明确地说，每个端点的IP地址对的最后8位字节必须取自下面的集合。<br>以下是可用IP：<br>注意：tun0网卡默认会使用[1,2]地址<br>[  1,  2]   [  5,  6]   [  9, 10]   [ 13, 14]   [ 17, 18]<br>[ 21, 22]   [ 25, 26]   [ 29, 30]   [ 33, 34]   [ 37, 38]<br>[ 41, 42]   [ 45, 46]   [ 49, 50]   [ 53, 54]   [ 57, 58]<br>[ 61, 62]   [ 65, 66]   [ 69, 70]   [ 73, 74]   [ 77, 78]<br>[ 81, 82]   [ 85, 86]   [ 89, 90]   [ 93, 94]   [ 97, 98]<br>[101,102]   [105,106]   [109,110]   [113,114]   [117,118]<br>[121,122]   [125,126]   [129,130]   [133,134]   [137,138]<br>[141,142]   [145,146]   [149,150]   [153,154]   [157,158]<br>[161,162]   [165,166]   [169,170]   [173,174]   [177,178]<br>[181,182]   [185,186]   [189,190]   [193,194]   [197,198]<br>[201,202]   [205,206]   [209,210]   [213,214]   [217,218]<br>[221,222]   [225,226]   [229,230]   [233,234]   [237,238]<br>[241,242]   [245,246]   [249,250]   [253,254]<br></code></pre></td></tr></table></figure>

<h2 id="1-2通过脚本颁发证书"><a href="#1-2通过脚本颁发证书" class="headerlink" title="1.2通过脚本颁发证书"></a>1.2通过脚本颁发证书</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">~/bin/bash</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment">#</span></span><br>. /etc/init.d/functions<br><br>OPENVPN_SERVER=&quot;openvpn.sdg.com.cn&quot;<br>PASS=123456<br>read -p &quot;请输入用户的姓名拼音(如:user1): &quot; NAME<br><br>remove_cert () &#123;<br>	rm -rf /etc/openvpn/client/$&#123;NAME&#125;<br>	find /etc/openvpn/ -name &quot;$NAME.*&quot; -delete<br>&#125;<br>create_cert () &#123;<br>	cd /data/easy-rsa<br>	./easyrsa gen-req $&#123;NAME&#125; nopass &lt;&lt;EOF<br>EOF<br>	cd /data/easy-rsa<br>	./easyrsa import-req /data/easy-rsa/pki/reqs/$&#123;NAME&#125;.req <br><span class="hljs-meta prompt_">	$</span><span class="language-bash">&#123;NAME&#125;</span><br><br>	./easyrsa sign client $&#123;NAME&#125; &lt;&lt;EOF<br>yes<br>Admin@sdg2022<br>EOF<br>	mkdir /etc/openvpn/client/$&#123;NAME&#125;<br>	cp /data/easy-rsa/pki/issued/$&#123;NAME&#125;.crt /etc/openvpn/client/$&#123;NAME&#125;<br>	cp /data/easy-rsa/pki/private/$&#123;NAME&#125;.key /etc/openvpn/client/$&#123;NAME&#125;<br>	cp /etc/openvpn/certs/&#123;ca.crt&#125; /etc/openvpn/client/$&#123;NAME&#125;<br>	cat &gt; /etc/openvpn/client/$&#123;NAME&#125;/client.ovpn &lt;&lt;EOF<br>client<br>dev tun<br>proto tcp<br>remote $&#123;OPENVPN_SERVER&#125; 11094<br>resolv-retry infinite<br>nobind<br>ca ca.crt<br>cert $NAME.crt<br>key $NAME.key<br>remote-cert-tls server<br>cipher AES-256-CBC<br>verb 3<br>compress lz4-v2<br>auth-user-pass<br>EOF<br>echo &quot;证书存放路径:/etc/openvpn/client/$&#123;NAME&#125;,证书文件如下:&quot;<br>echo -e &quot;\E[1;32m******************************************************************\E[0m&quot;<br><br>ls -l /etc/openvpn/client/$&#123;NAME&#125;<br><br>echo -e &quot;\E[1;32m******************************************************************\E[0m&quot;<br><br>cd /etc/openvpn/client/$&#123;NAME&#125;<br>zip /root/$&#123;NAME&#125;.zip *<br>action &quot;证书的打包文件已生成: /root/$&#123;NAME&#125;.zip&quot;<br>&#125;<br><br><br>remove_cert<br>create_cert<br></code></pre></td></tr></table></figure>

<h2 id="1-3实现用户密码认证"><a href="#1-3实现用户密码认证" class="headerlink" title="1.3实现用户密码认证"></a>1.3实现用户密码认证</h2><h3 id="1-3-1修改服务端配置"><a href="#1-3-1修改服务端配置" class="headerlink" title="1.3.1修改服务端配置"></a>1.3.1修改服务端配置</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@VPN ~]<span class="hljs-comment"># vim /etc/openvpn/server.conf</span><br><span class="hljs-comment"># 添加三行，实现服务端支持密码认证方式</span><br>script-security 3 <span class="hljs-comment"># 允许使用自定义脚本</span><br>auth-user-pass-verify /etc/openvpn/checkpsw.sh via-env <span class="hljs-comment">#指定自定义脚本路径</span><br>username-as-common-name <span class="hljs-comment">#开启用户密码验证</span><br></code></pre></td></tr></table></figure>

<h3 id="1-3-2创建自定义脚本"><a href="#1-3-2创建自定义脚本" class="headerlink" title="1.3.2创建自定义脚本"></a>1.3.2创建自定义脚本</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@VPN ~]<span class="hljs-comment"># vim /etc/openvpn/checkpsw.sh</span><br><span class="hljs-comment">#!/bin/sh</span><br><span class="hljs-comment">###########################################################</span><br><span class="hljs-comment"># checkpsw.sh (C) 2004 Mathias Sundman &lt;mathias@openvpn.se&gt;</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># This script will authenticate OpenVPN users against</span><br><span class="hljs-comment"># a plain text file. The passfile should simply contain</span><br><span class="hljs-comment"># one row per user with the username first followed by</span><br><span class="hljs-comment"># one or more space(s) or tab(s) and then the password.</span><br><span class="hljs-comment">###########################################################</span><br>PASSFILE=<span class="hljs-string">&quot;/etc/openvpn/psw-file&quot;</span><br>LOG_FILE=<span class="hljs-string">&quot;/var/log/openvpn-password.log&quot;</span><br>TIME_STAMP=`<span class="hljs-built_in">date</span> <span class="hljs-string">&quot;+%Y-%m-%d %T&quot;</span>`<br><span class="hljs-keyword">if</span> [ ! -r <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;PASSFILE&#125;</span>&quot;</span> ]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;TIME_STAMP&#125;</span>: Could not open password file \&quot;<span class="hljs-variable">$&#123;PASSFILE&#125;</span>\&quot; for</span><br><span class="hljs-string">reading.&quot;</span> &gt;&gt; <span class="hljs-variable">$&#123;LOG_FILE&#125;</span><br><span class="hljs-built_in">exit</span> 1<br><span class="hljs-keyword">fi</span><br>CORRECT_PASSWORD=`awk <span class="hljs-string">&#x27;!/^;/&amp;&amp;!/^#/&amp;&amp;$1==&quot;&#x27;</span><span class="hljs-variable">$&#123;username&#125;</span><span class="hljs-string">&#x27;&quot;&#123;print $2;exit&#125;&#x27;</span><br><span class="hljs-variable">$&#123;PASSFILE&#125;</span>`<br><span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;CORRECT_PASSWORD&#125;</span>&quot;</span> = <span class="hljs-string">&quot;&quot;</span> ]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;TIME_STAMP&#125;</span>: User does not exist: username=\&quot;<span class="hljs-variable">$&#123;username&#125;</span>\&quot;,</span><br><span class="hljs-string">password=\&quot;<span class="hljs-variable">$&#123;password&#125;</span>\&quot;.&quot;</span> &gt;&gt; <span class="hljs-variable">$&#123;LOG_FILE&#125;</span><br><span class="hljs-built_in">exit</span> 1<br><span class="hljs-keyword">fi</span><br><span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;password&#125;</span>&quot;</span> = <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;CORRECT_PASSWORD&#125;</span>&quot;</span> ]; <span class="hljs-keyword">then</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;TIME_STAMP&#125;</span>: Successful authentication: username=\&quot;<span class="hljs-variable">$&#123;username&#125;</span>\&quot;.&quot;</span><br>&gt;&gt; <span class="hljs-variable">$&#123;LOG_FILE&#125;</span><br><span class="hljs-built_in">exit</span> 0<br><span class="hljs-keyword">fi</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;TIME_STAMP&#125;</span>: Incorrect password: username=\&quot;<span class="hljs-variable">$&#123;username&#125;</span>\&quot;,</span><br><span class="hljs-string">password=\&quot;<span class="hljs-variable">$&#123;password&#125;</span>\&quot;.&quot;</span> &gt;&gt; <span class="hljs-variable">$&#123;LOG_FILE&#125;</span><br><span class="hljs-built_in">exit</span> 1<br><br><span class="hljs-comment">#增加执行权限</span><br>[root@centos8 ~]<span class="hljs-comment"># chmod +x /etc/openvpn/checkpsw.sh</span><br></code></pre></td></tr></table></figure>

<h3 id="1-3-3创建用户密码文件"><a href="#1-3-3创建用户密码文件" class="headerlink" title="1.3.3创建用户密码文件"></a>1.3.3创建用户密码文件</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@VPN openvpn]<span class="hljs-comment"># pwd</span><br>/etc/openvpn<br><br><span class="hljs-comment">#创建创建存储用户密码文件</span><br>[root@VPN openvpn]<span class="hljs-comment"># vim /etc/openvpn/psw-file</span><br><span class="hljs-built_in">test</span> 123456<br>test1 123123<br><br><span class="hljs-comment"># 创建用户和密码认证文件,每行是一个用户和密码</span><br>[root@VPN openvpn]<span class="hljs-comment"># cat psw-file </span><br><span class="hljs-built_in">test</span> 123456<br>test1 123123<br><br>[root@centos8 ~]<span class="hljs-comment"># systemctl restart openvpn@server</span><br></code></pre></td></tr></table></figure>

<h3 id="1-3-4修改客户端配置"><a href="#1-3-4修改客户端配置" class="headerlink" title="1.3.4修改客户端配置"></a>1.3.4修改客户端配置</h3><p>修改客户端配置文件client.ovpn文件，增加下面一行,使其支持用户名/密码与服务器进行身份验证.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">[root@VPN openvpn]<span class="hljs-comment"># vim /etc/openvpn/client/wangxiaochun/client.ovpn</span><br><span class="hljs-comment">#加下面一行,可以支持用户密码认证</span><br>auth-user-pass<br></code></pre></td></tr></table></figure>

<p><img src="image-20220830231855729-16618737586081.png" srcset="/img/loading.gif" lazyload alt="image-20220830231855729"></p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/08/14/%E4%BA%8C%E5%91%A8%E7%9A%84%E4%BD%9C%E4%B8%9A/">
                        <span class="hidden-mobile">二周的作业</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
        typing(title);
      
    })(window, document);
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
